!function(){"use strict";var t,e,n,o=1e3,r=800;!function(t){t.WOLF="wolf",t.HUNTER="hunter",t.RABBIT="rabbit",t.FALLOW_DEER="fallowDeer",t.BULLET="bullet"}(t||(t={}));var i,a,s=function(t){var e=new Image(20,20);return e.src=t,e},c=((e={})[t.HUNTER]="red",e[t.WOLF]="gray",e[t.RABBIT]="blue",(n={})[t.HUNTER]=s("images/hunter.png"),n[t.WOLF]=s("images/wolf.png"),n[t.RABBIT]=s("images/rabbit.png"),n[t.FALLOW_DEER]=s("images/deer.png"),n),u=function(){function e(){}return e.prototype.createCanvas=function(){var t;return this.canvas=document.getElementById("canvas"),this.context=null===(t=this.canvas)||void 0===t?void 0:t.getContext("2d"),this.canvas.width=o,this.canvas.height=r,this.canvas},e.prototype.drawObject=function(e){if(e.characterType===t.BULLET)this.context.beginPath(),this.context.arc(e.location.x,e.location.y,3,0,2*Math.PI),this.context.fillStyle="red",this.context.fill(),this.context.restore();else{var n=c[e.characterType],o=e.velocity.heading+Math.PI/2;this.context.save(),this.context.translate(e.location.x-10,e.location.y-10),this.context.rotate(o),this.context.drawImage(n,-10,-10,2*e.radius,2*e.radius),this.context.restore()}},e.prototype.drawField=function(t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.lineWidth=4,this.context.strokeStyle="#000",this.context.strokeRect(0,0,this.canvas.width,this.canvas.height),t.forEach(this.drawObject.bind(this))},e}(),h=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.mult=function(t){this.x*=t,this.y*=t},t.prototype.normalize=function(){var t=this.length;0!==t&&(this.x/=t,this.y/=t)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},enumerable:!1,configurable:!0}),t.prototype.add=function(t){this.x+=t.x,this.y+=t.y},t.prototype.limit=function(t){this.length>t&&(this.normalize(),this.mult(t))},t.prototype.clone=function(){return new t(this.x,this.y)},Object.defineProperty(t.prototype,"heading",{get:function(){return Math.atan2(this.y,this.x)},enumerable:!1,configurable:!0}),t.prototype.div=function(t){this.x/=t.x,this.y/=t.y},t.dist=function(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(Math.pow(n,2)+Math.pow(o,2))},t.sum=function(e,n){return new t(e.x+n.x,e.y+n.y)},t.sub=function(e,n){return new t(e.x-n.x,e.y-n.y)},t.div=function(e,n){return new t(e.x/n,e.y/n)},t}(),l=function(){function t(t,e){this.baseMaxSpeed=4,this.maxForce=.1,this.radius=10,this.acceleration=new h(0,0),this.velocity=new h(0,0),this.location=new h(t,e)}return Object.defineProperty(t.prototype,"maxSpeed",{get:function(){return this.baseMaxSpeed},enumerable:!1,configurable:!0}),t.prototype.applyForce=function(t){this.acceleration.add(t)},t.prototype.update=function(){this.velocity.add(this.acceleration),this.velocity.limit(this.maxSpeed),this.location.add(this.velocity),this.acceleration.mult(0)},t}(),p=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),y=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.wanderAngle=0,o}return p(e,t),e.prototype.getCurrentBehaviourForce=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.wander()},e.prototype.simulateCurrentBehaviour=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.getCurrentBehaviourForce.apply(this,t);this.applyForce(n),this.stayWithinWalls(),this.update()},e.prototype.seek=function(t){var e=h.sub(t,this.location);e.normalize(),e.mult(this.maxSpeed);var n=h.sub(e,this.velocity);return n.limit(this.maxForce),n},e.prototype.flee=function(t){var e=h.sub(t,this.location);e.normalize(),e.mult(this.maxSpeed),e.mult(-1);var n=h.sub(e,this.velocity);return n.limit(this.maxForce),n},e.prototype.arrive=function(t){var e=h.sub(t,this.location),n=e.length;if(e.normalize(),n<100){var o=n/100*this.maxSpeed;e.mult(o)}else e.mult(this.maxSpeed);var r=h.sub(e,this.velocity);return r.limit(this.maxForce),r},e.prototype.wander=function(){var t=this.velocity.clone();t.normalize(),t.mult(5);var e=new h(0,-1);e.mult(20),this.setAngle(e,this.wanderAngle),this.wanderAngle+=Math.random()>.5?-30:30;var n=h.sum(t,e);return n.limit(this.maxForce),n},e.prototype.stayWithinWalls=function(){var t;if(this.location.x<60?t=new h(this.maxSpeed,this.velocity.y):this.location.x>940&&(t=new h(-this.maxSpeed,this.velocity.y)),this.location.y<60?t=new h(this.velocity.x,this.maxSpeed):this.location.y>740&&(t=new h(this.velocity.x,-this.maxSpeed)),t){var e=h.sub(t,this.velocity);e.limit(3.5*this.maxForce),this.applyForce(e)}},e.prototype.separate=function(t){var e=this,n=10*this.radius,o=new h(0,0),r=0;if(t.forEach((function(t){var i=h.dist(e.location,t.location);if(i>0&&i<n){var a=h.sub(e.location,t.location);a.normalize(),a.mult(1/i),o.add(a),r++}})),r>0){o.mult(1/r),o.normalize(),o.mult(this.maxSpeed);var i=h.sub(o,this.velocity);return i.limit(this.maxForce),i}return new h(0,0)},e.prototype.flock=function(t){var e=this.separate(t),n=this.align(t),o=this.cohesion(t);e.mult(1.5),n.mult(1),o.mult(1);var r=new h(0,0);return r.add(e),r.add(n),r.add(o),r},e.prototype.align=function(t){var e=this,n=new h(0,0),o=0;if(t.forEach((function(t){var r=h.dist(e.location,t.location);r>0&&r<100&&(n.add(t.velocity),o++)})),o>0){n.mult(1/o),n.normalize(),n.mult(this.maxSpeed);var r=h.sub(n,this.velocity);return r.limit(this.maxForce),r}return new h(0,0)},e.prototype.cohesion=function(t){var e=this,n=new h(0,0),o=0;return t.forEach((function(t){var r=h.dist(e.location,t.location);r>0&&r<75&&(n.add(t.location),o++)})),o>0?(n.mult(1/o),this.seek(n)):new h(0,0)},e.prototype.setAngle=function(t,e){var n=t.length;t.x=Math.cos(e)*n,t.y=Math.sin(e)*n},e}(l),f=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isDead=!1,e}return f(e,t),e.prototype.kill=function(){this.isDead=!0},e.prototype.update=function(){t.prototype.update.call(this);var e=.5*this.radius;(this.location.x<e||this.location.x>o-e||this.location.y<e||this.location.y>r-e)&&this.kill()},e}(y),v=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=function(e){function n(n,o){var r=e.call(this,n,o)||this;return r.baseMaxSpeed=6,r.characterType=t.RABBIT,r.separate=r.separate.bind(r),r}return v(n,e),n.prototype.getCurrentBehaviourForce=function(t){var n=e.prototype.separate.call(this,t);return 0===n.x&&0===n.y?this.wander():(n.mult(1.1),n)},n}(d),w=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),x=function(e){function n(n,o){var r=e.call(this,n,o)||this;return r.baseMaxSpeed=3,r.power=20,r.characterType=t.WOLF,r.decreasePower=r.decreasePower.bind(r),r.powerTimer=window.setInterval(r.decreasePower,1e3),r}return w(n,e),n.prototype.kill=function(){clearInterval(this.powerTimer),e.prototype.kill.call(this)},n.prototype.getCurrentBehaviourForce=function(t){return this.hunt(t)},n.prototype.decreasePower=function(){this.power--,0===this.power&&this.kill()},n.prototype.eatEnemy=function(t){this.power+=n.ENEMIES_POWER_REWARD[t.characterType],t.kill()},n.prototype.hunt=function(t){var e=this,o=t.filter((function(t){return n.ENEMIES.includes(t.characterType)})).map((function(t){return{enemy:t,dist:h.dist(e.location,t.location)}})).filter((function(t){return t.dist<=t.enemy.radius?(e.eatEnemy(t.enemy),!1):t.dist<100})).sort((function(t,e){return t.dist-e.dist}))[0];return o?this.seek(o.enemy.location):this.wander()},n.ENEMIES=[t.RABBIT,t.FALLOW_DEER,t.HUNTER],n.ENEMIES_POWER_REWARD=((a={})[t.RABBIT]=10,a[t.FALLOW_DEER]=20,a[t.HUNTER]=20,a),n}(d),b=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),_=function(e){function n(n,o){var r=e.call(this,n.x,n.y)||this;return r.startLocation=n,r.direction=o,r.baseMaxSpeed=20,r.maxShotDistance=200,r.characterType=t.BULLET,r}return b(n,e),n.prototype.getCurrentBehaviourForce=function(t){return this.fly(t)},n.prototype.fly=function(e){var n=this;return h.dist(this.location,this.startLocation)>this.maxShotDistance?(this.kill(),new h(0,0)):(e.forEach((function(e){h.dist(n.location,e.location)<e.radius&&e.characterType!==t.HUNTER&&(e.kill(),n.kill())})),this.direction)},n}(d),g=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),E=function(e){function n(n,o){var r=e.call(this,n,o)||this;return r.baseMaxSpeed=2,r.bulletsCount=10,r.bullets=[],r.radius=13,r.characterType=t.HUNTER,r.handleKeyPress=r.handleKeyPress.bind(r),r.shot=r.shot.bind(r),r.startListeningUserActions(),r}return g(n,e),n.prototype.getCurrentBehaviourForce=function(t){return this.arrive(t)},n.prototype.kill=function(){window.removeEventListener("keypress",this.handleKeyPress),window.removeEventListener("click",this.shot),e.prototype.kill.call(this)},n.prototype.startListeningUserActions=function(){window.addEventListener("keypress",this.handleKeyPress),window.addEventListener("click",this.shot)},n.prototype.handleKeyPress=function(t){" "===t.key&&this.shot()},n.prototype.shot=function(){if(this.bulletsCount){var t=new _(this.location,this.velocity.clone());this.bullets.push(t),this.bulletsCount--}},n}(d),O=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,r++)o[r]=i[a];return o},A=new u,P=new Array(10).fill(0).map((function(){return new m(Math.random()*o,Math.random()*r)})),F=new Array(4).fill(0).map((function(){return new x(Math.random()*o,Math.random()*r)})),M=new E(Math.random()*o,Math.random()*r),B=O(P,F),L=(new l(500,350),new h(0,0));document.getElementById("canvas").addEventListener("mousemove",(function(t){L.x=t.clientX,L.y=t.clientY})),A.createCanvas();var T=function(){B=B.filter((function(t){return!t.isDead}));var t=O(B);M.isDead||t.push(M),B.forEach((function(e){e.simulateCurrentBehaviour(t)})),M.bullets=M.bullets.filter((function(t){return!t.isDead})),M.bullets.forEach((function(e){return e.simulateCurrentBehaviour(t)})),M.isDead||M.simulateCurrentBehaviour(L),A.drawField(O(t,M.bullets)),requestAnimationFrame(T)};T()}();