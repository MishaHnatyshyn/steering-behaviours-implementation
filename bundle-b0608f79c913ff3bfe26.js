!function(){"use strict";var t,e,n=1e3,r=800,o=document.getElementById("canvas");!function(t){t.WOLF="wolf",t.HUNTER="hunter",t.RABBIT="rabbit",t.FALLOW_DEER="fallowDeer",t.BULLET="bullet"}(t||(t={}));var i,a,s=function(t){var e=new Image(20,20);return e.src=t,e},c=((e={})[t.HUNTER]=s("images/hunter.png"),e[t.WOLF]=s("images/wolf.png"),e[t.RABBIT]=s("images/rabbit.png"),e[t.FALLOW_DEER]=s("images/deer.png"),e),u=function(){function e(){}return e.prototype.createCanvas=function(){var t;return this.canvas=document.getElementById("canvas"),this.context=null===(t=this.canvas)||void 0===t?void 0:t.getContext("2d"),this.canvas.width=n,this.canvas.height=r,this.canvas},e.prototype.drawObject=function(e){if(e.characterType===t.BULLET)this.context.beginPath(),this.context.arc(e.location.x,e.location.y,3,0,2*Math.PI),this.context.fillStyle="red",this.context.fill(),this.context.restore();else{var n=c[e.characterType],r=e.velocity.heading+Math.PI/2;this.context.save(),this.context.translate(e.location.x-10,e.location.y-10),this.context.rotate(r),this.context.drawImage(n,-10,-10,2*e.radius,2*e.radius),this.context.restore()}},e.prototype.drawField=function(t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.lineWidth=4,this.context.strokeStyle="#000",this.context.strokeRect(0,0,this.canvas.width,this.canvas.height),t.forEach(this.drawObject.bind(this))},e.prototype.drawBulletsAmount=function(t,e){e.innerText=t},e}(),h=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.mult=function(t){this.x*=t,this.y*=t},t.prototype.normalize=function(){var t=this.length;0!==t&&(this.x/=t,this.y/=t)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},enumerable:!1,configurable:!0}),t.prototype.add=function(t){this.x+=t.x,this.y+=t.y},t.prototype.limit=function(t){this.length>t&&(this.normalize(),this.mult(t))},t.prototype.clone=function(){return new t(this.x,this.y)},Object.defineProperty(t.prototype,"heading",{get:function(){return Math.atan2(this.y,this.x)},enumerable:!1,configurable:!0}),t.prototype.isNull=function(){return 0===this.x&&0===this.y},t.dist=function(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(Math.pow(n,2)+Math.pow(r,2))},t.sum=function(e,n){return new t(e.x+n.x,e.y+n.y)},t.sub=function(e,n){return new t(e.x-n.x,e.y-n.y)},t}(),l=function(){function t(t,e){this.baseMaxSpeed=4,this.maxForce=.1,this.radius=10,this.acceleration=new h(0,0),this.velocity=new h(0,0),this.location=new h(t,e)}return Object.defineProperty(t.prototype,"maxSpeed",{get:function(){return this.baseMaxSpeed},enumerable:!1,configurable:!0}),t.prototype.applyForce=function(t){this.acceleration.add(t)},t.prototype.update=function(){this.velocity.add(this.acceleration),this.velocity.limit(this.maxSpeed),this.location.add(this.velocity),this.acceleration.mult(0)},t}(),p=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),f=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.wanderAngle=0,r}return p(e,t),e.prototype.getCurrentBehaviourForce=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.wander()},e.prototype.simulateCurrentBehaviour=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.getCurrentBehaviourForce.apply(this,t);this.applyForce(n),this.stayWithinWalls(),this.update()},e.prototype.seek=function(t){var e=h.sub(t,this.location);e.normalize(),e.mult(this.maxSpeed);var n=h.sub(e,this.velocity);return n.limit(this.maxForce),n},e.prototype.flee=function(t){var e=h.sub(t,this.location);e.normalize(),e.mult(this.maxSpeed),e.mult(-1);var n=h.sub(e,this.velocity);return n.limit(this.maxForce),n},e.prototype.arrive=function(t){var e=h.sub(t,this.location),n=e.length;if(e.normalize(),n<100){var r=n/100*this.maxSpeed;e.mult(r)}else e.mult(this.maxSpeed);var o=h.sub(e,this.velocity);return o.limit(this.maxForce),o},e.prototype.wander=function(){var t=this.velocity.clone();t.normalize(),t.mult(5);var e=new h(0,-1);e.mult(20),this.setAngle(e,this.wanderAngle),this.wanderAngle+=Math.random()>.5?-30:30;var n=h.sum(t,e);return n.limit(this.maxForce),n},e.prototype.stayWithinWalls=function(){var t;if(this.location.x<60?t=new h(this.maxSpeed,this.velocity.y):this.location.x>940&&(t=new h(-this.maxSpeed,this.velocity.y)),this.location.y<60?t=new h(this.velocity.x,this.maxSpeed):this.location.y>740&&(t=new h(this.velocity.x,-this.maxSpeed)),t){var e=h.sub(t,this.velocity);e.limit(3.5*this.maxForce),this.applyForce(e)}},e.prototype.separate=function(t,e){var n=this,r=e||5*this.radius,o=new h(0,0),i=0;if(t.forEach((function(t){var e=h.dist(n.location,t.location);if(e>0&&e<r){var a=h.sub(n.location,t.location);a.normalize(),a.mult(1/e),o.add(a),i++}})),i>0){o.mult(1/i),o.normalize(),o.mult(this.maxSpeed);var a=h.sub(o,this.velocity);return a.limit(this.maxForce),a}return new h(0,0)},e.prototype.flock=function(t){var e=this.separate(t),n=this.align(t),r=this.cohesion(t);e.mult(1.3),n.mult(1),r.mult(1);var o=new h(0,0);return o.add(e),o.add(n),o.add(r),o},e.prototype.align=function(t){var e=this,n=new h(0,0),r=10*this.radius,o=0;if(t.forEach((function(t){var i=h.dist(e.location,t.location);i>0&&i<r&&(n.add(t.velocity),o++)})),o>0){n.mult(1/o),n.normalize(),n.mult(this.maxSpeed);var i=h.sub(n,this.velocity);return i.limit(this.maxForce),i}return new h(0,0)},e.prototype.cohesion=function(t){var e=this,n=new h(0,0),r=10*this.radius,o=0;return t.forEach((function(t){var i=h.dist(e.location,t.location);i>0&&i<r&&(n.add(t.location),o++)})),o>0?(n.mult(1/o),this.seek(n)):new h(0,0)},e.prototype.setAngle=function(t,e){var n=t.length;t.x=Math.cos(e)*n,t.y=Math.sin(e)*n},e}(l),y=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isDead=!1,e}return y(e,t),e.prototype.kill=function(){this.isDead=!0},e.prototype.update=function(){t.prototype.update.call(this);var e=.5*this.radius;(this.location.x<e||this.location.x>n-e||this.location.y<e||this.location.y>r-e)&&this.kill()},e}(f),v=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),m=function(e){function n(n,r){var o=e.call(this,n,r)||this;return o.wanderingSpeed=3,o.separationSpeed=8,o.characterType=t.RABBIT,o.separate=o.separate.bind(o),o}return v(n,e),n.prototype.getCurrentBehaviourForce=function(t){var n=e.prototype.separate.call(this,t);return n.isNull()?(this.baseMaxSpeed=this.wanderingSpeed,this.wander()):(this.baseMaxSpeed=this.separationSpeed,n.mult(1.1),n)},n}(d),b=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),w=function(e){function n(n,r){var o=e.call(this,n.x,n.y)||this;return o.startLocation=n,o.direction=r,o.baseMaxSpeed=20,o.maxShotDistance=200,o.characterType=t.BULLET,o}return b(n,e),n.prototype.getCurrentBehaviourForce=function(t){return this.fly(t)},n.prototype.fly=function(e){var n=this;return h.dist(this.location,this.startLocation)>this.maxShotDistance?(this.kill(),new h(0,0)):(e.forEach((function(e){h.dist(n.location,e.location)<e.radius&&e.characterType!==t.HUNTER&&(e.kill(),n.kill())})),this.direction)},n}(d),g=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),x=function(e){function n(n,r){var o=e.call(this,n,r)||this;return o.baseMaxSpeed=3,o.bulletsCount=10,o.bullets=[],o.radius=13,o.characterType=t.HUNTER,o.handleKeyPress=o.handleKeyPress.bind(o),o.shot=o.shot.bind(o),o.startListeningUserActions(),o}return g(n,e),n.prototype.getCurrentBehaviourForce=function(t){return this.arrive(t)},n.prototype.kill=function(){window.removeEventListener("keypress",this.handleKeyPress),window.removeEventListener("click",this.shot),e.prototype.kill.call(this)},n.prototype.startListeningUserActions=function(){window.addEventListener("keypress",this.handleKeyPress),o.addEventListener("click",this.shot)},n.prototype.handleKeyPress=function(t){" "===t.key&&this.shot()},n.prototype.shot=function(){if(this.bulletsCount&&!this.isDead){var t=new w(this.location,this.velocity.clone());this.bullets.push(t),this.bulletsCount--}},n}(d),_=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),E=function(e){function n(n,r){var o=e.call(this,n,r)||this;return o.baseMaxSpeed=5,o.power=20,o.characterType=t.WOLF,o.decreasePower=o.decreasePower.bind(o),o.powerTimer=window.setInterval(o.decreasePower,1e3),o}return _(n,e),n.prototype.kill=function(){clearInterval(this.powerTimer),e.prototype.kill.call(this)},n.prototype.getCurrentBehaviourForce=function(t){return this.hunt(t)},n.prototype.decreasePower=function(){this.power--,0===this.power&&this.kill()},n.prototype.eatEnemy=function(t){this.power+=n.ENEMIES_POWER_REWARD[t.characterType],t.kill()},n.prototype.hunt=function(t){var e=this,r=t.filter((function(t){return n.ENEMIES.includes(t.characterType)})),o=10*this.radius,i=r.map((function(t){return{enemy:t,dist:h.dist(e.location,t.location)}})).filter((function(t){return t.dist<=t.enemy.radius?(e.eatEnemy(t.enemy),!1):t.dist<o})).sort((function(t,e){return t.dist-e.dist}))[0];return i?this.seek(i.enemy.location):this.wander()},n.ENEMIES=[t.RABBIT,t.FALLOW_DEER,t.HUNTER],n.ENEMIES_POWER_REWARD=((a={})[t.RABBIT]=10,a[t.FALLOW_DEER]=20,a[t.HUNTER]=20,a),n}(d),O=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),M=function(e){function n(n,r,o){var i=e.call(this,n,r)||this;return i.groupId=o,i.baseMaxSpeed=4,i.characterType=t.FALLOW_DEER,i}return O(n,e),n.prototype.isFallowDeer=function(e){return e.characterType===t.FALLOW_DEER},n.prototype.getCurrentBehaviourForce=function(n){var r=this,o=n.filter((function(t){return r.isFallowDeer(t)&&(null==t?void 0:t.groupId)===r.groupId&&t!==r})),i=n.filter((function(e){return e.characterType===t.WOLF})),a=e.prototype.separate.call(this,i,15*this.radius);if(o.length<=2&&!a.isNull())return a;if(o.length<=2)return this.wander();var s=e.prototype.flock.call(this,o);if(s.isNull()){var c=o.map((function(t){return{object:t,distance:h.dist(r.location,t.location)}})).sort((function(t,e){return t.distance-e.distance}))[0].object.location,u=this.seek(c);return u.mult(2),h.sum(a,u)}return a.mult(3),h.sum(a,s)},n}(d),A=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},F=document.getElementById("bulletsNumber"),I=document.getElementById("bulletsAmountText"),R=function(){function t(t){this.field=t,this.rabbits=[],this.wolves=[],this.deers=[],this.deerGroups=[],this.hunter=null,this.objects=[],this.mouse=new h(0,0),this.handleMouseMove(),this.startGame(),this.updateFrame()}return t.prototype.getRandIntInRange=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.prototype.startGame=function(t,e,o){var i=this;void 0===t&&(t=7),void 0===e&&(e=3),void 0===o&&(o=15),I.style.display="block";var a=Math.floor(o/8)+1,s=Math.floor(o/3),c=this.getRandIntInRange(a,s),u=o;this.deerGroups=new Array(c).fill(0).map((function(t,e){var o=u-3*(c-e-1),a=Math.min(o,8),s=e===c-1?u:i.getRandIntInRange(3,a);u-=s;var h=Math.random()*n,l=Math.random()*r;return new Array(s).fill(0).map((function(){return new M(i.getRandIntInRange(h-10,h+10),i.getRandIntInRange(l-10,l+10),e)}))})),console.log(this.deerGroups),this.deers=this.deerGroups.flat(),this.rabbits=new Array(t).fill(0).map((function(){return new m(Math.random()*n,Math.random()*r)})),this.wolves=new Array(e).fill(0).map((function(){return new E(Math.random()*n,Math.random()*r)})),this.hunter=new x(Math.random()*n,Math.random()*r),this.objects=A(this.rabbits,this.wolves,this.deers)},t.prototype.updateFrame=function(){this.objects=this.objects.filter((function(t){return!t.isDead}));var t=A(this.objects);this.hunter.isDead||t.push(this.hunter),this.objects.forEach((function(e){e.simulateCurrentBehaviour(t)})),this.hunter.bullets=this.hunter.bullets.filter((function(t){return!t.isDead})),this.hunter.bullets.forEach((function(e){return e.simulateCurrentBehaviour(t)})),this.hunter.isDead?I.style.display="none":(this.hunter.simulateCurrentBehaviour(this.mouse),this.field.drawBulletsAmount(this.hunter.bulletsCount,F)),this.field.drawField(A(t,this.hunter.bullets)),requestAnimationFrame(this.updateFrame.bind(this))},t.prototype.handleMouseMove=function(){var t=this;o.addEventListener("mousemove",(function(e){t.mouse.x=e.clientX,t.mouse.y=e.clientY}))},t}(),S=document.getElementById("form"),j=document.getElementById("rabbits"),B=document.getElementById("deers"),L=document.getElementById("wolves"),P=new u;P.createCanvas(),j.value=String(7),L.value=String(3),B.value=String(15);var T=new R(P);S.addEventListener("submit",(function(t){t.preventDefault(),t.target[3].blur(),T.startGame(Number(j.value),Number(L.value))}))}();