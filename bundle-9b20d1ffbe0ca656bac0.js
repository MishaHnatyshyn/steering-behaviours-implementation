!function(){"use strict";var t,e,n=1e3,r=800,o=document.getElementById("canvas");!function(t){t.WOLF="wolf",t.HUNTER="hunter",t.RABBIT="rabbit",t.FALLOW_DEER="fallowDeer",t.BULLET="bullet"}(t||(t={}));var i,a,s,u=function(t){var e=new Image(20,20);return e.src=t,e},c=((e={})[t.HUNTER]=u("images/hunter.png"),e[t.WOLF]=u("images/wolf.png"),e[t.RABBIT]=u("images/rabbit.png"),e[t.FALLOW_DEER]=u("images/deer.png"),e),h=function(){function e(){}return e.prototype.createCanvas=function(){var t;return this.canvas=document.getElementById("canvas"),this.context=null===(t=this.canvas)||void 0===t?void 0:t.getContext("2d"),this.canvas.width=n,this.canvas.height=r,this.canvas},e.prototype.drawObject=function(e){if(e.characterType===t.BULLET)this.context.beginPath(),this.context.arc(e.location.x,e.location.y,3,0,2*Math.PI),this.context.fillStyle="red",this.context.fill(),this.context.restore();else{var n=c[e.characterType],r=e.velocity.heading+Math.PI/2;this.context.save(),this.context.translate(e.location.x-10,e.location.y-10),this.context.rotate(r),this.context.drawImage(n,-10,-10,2*e.radius,2*e.radius),this.context.restore()}},e.prototype.drawField=function(t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.lineWidth=4,this.context.strokeStyle="#000",this.context.strokeRect(0,0,this.canvas.width,this.canvas.height),t.forEach(this.drawObject.bind(this))},e.prototype.drawBulletsAmount=function(t,e){e.innerText=t},e}(),l=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.mult=function(t){this.x*=t,this.y*=t},t.prototype.normalize=function(){var t=this.length;0!==t&&(this.x/=t,this.y/=t)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},enumerable:!1,configurable:!0}),t.prototype.add=function(t){this.x+=t.x,this.y+=t.y},t.prototype.limit=function(t){this.length>t&&(this.normalize(),this.mult(t))},t.prototype.clone=function(){return new t(this.x,this.y)},Object.defineProperty(t.prototype,"heading",{get:function(){return Math.atan2(this.y,this.x)},enumerable:!1,configurable:!0}),t.prototype.isNull=function(){return 0===this.x&&0===this.y},t.dist=function(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(Math.pow(n,2)+Math.pow(r,2))},t.sum=function(e,n){return new t(e.x+n.x,e.y+n.y)},t.sub=function(e,n){return new t(e.x-n.x,e.y-n.y)},t}(),p=function(){function t(t,e){this.baseMaxSpeed=4,this.maxForce=.1,this.radius=10,this.acceleration=new l(0,0),this.velocity=new l(0,0),this.location=new l(t,e)}return Object.defineProperty(t.prototype,"maxSpeed",{get:function(){return this.baseMaxSpeed},enumerable:!1,configurable:!0}),t.prototype.applyForce=function(t){this.acceleration.add(t)},t.prototype.update=function(){this.velocity.add(this.acceleration),this.velocity.limit(this.maxSpeed),this.location.add(this.velocity),this.acceleration.mult(0)},t}(),f=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),y=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.wanderAngle=0,r}return f(e,t),e.prototype.getCurrentBehaviourForce=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.wander()},e.prototype.simulateCurrentBehaviour=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.getCurrentBehaviourForce.apply(this,t);this.applyForce(n),this.stayWithinWalls(),this.update()},e.prototype.seek=function(t){var e=l.sub(t,this.location);e.normalize(),e.mult(this.maxSpeed);var n=l.sub(e,this.velocity);return n.limit(this.maxForce),n},e.prototype.flee=function(t){var e=l.sub(t,this.location);e.normalize(),e.mult(this.maxSpeed),e.mult(-1);var n=l.sub(e,this.velocity);return n.limit(this.maxForce),n},e.prototype.arrive=function(t){var e=l.sub(t,this.location),n=e.length;if(e.normalize(),n<100){var r=n/100*this.maxSpeed;e.mult(r)}else e.mult(this.maxSpeed);var o=l.sub(e,this.velocity);return o.limit(this.maxForce),o},e.prototype.wander=function(){var t=this.velocity.clone();t.normalize(),t.mult(5);var e=new l(0,-1);e.mult(20),this.setAngle(e,this.wanderAngle),this.wanderAngle+=Math.random()>.5?-30:30;var n=l.sum(t,e);return n.limit(this.maxForce),n},e.prototype.stayWithinWalls=function(){var t;if(this.location.x<60?t=new l(this.maxSpeed,this.velocity.y):this.location.x>940&&(t=new l(-this.maxSpeed,this.velocity.y)),this.location.y<60?t=new l(this.velocity.x,this.maxSpeed):this.location.y>740&&(t=new l(this.velocity.x,-this.maxSpeed)),t){var e=l.sub(t,this.velocity);e.limit(3.5*this.maxForce),this.applyForce(e)}},e.prototype.separate=function(t,e){var n=this,r=e||5*this.radius,o=new l(0,0),i=0;if(t.forEach((function(t){var e=l.dist(n.location,t.location);if(e>0&&e<r){var a=l.sub(n.location,t.location);a.normalize(),a.mult(1/e),o.add(a),i++}})),i>0){o.mult(1/i),o.normalize(),o.mult(this.maxSpeed);var a=l.sub(o,this.velocity);return a.limit(this.maxForce),a}return new l(0,0)},e.prototype.flock=function(t){var e=this.separate(t),n=this.align(t),r=this.cohesion(t);e.mult(1.3),n.mult(1),r.mult(1);var o=new l(0,0);return o.add(e),o.add(n),o.add(r),o},e.prototype.align=function(t){var e=this,n=new l(0,0),r=10*this.radius,o=0;if(t.forEach((function(t){var i=l.dist(e.location,t.location);i>0&&i<r&&(n.add(t.velocity),o++)})),o>0){n.mult(1/o),n.normalize(),n.mult(this.maxSpeed);var i=l.sub(n,this.velocity);return i.limit(this.maxForce),i}return new l(0,0)},e.prototype.cohesion=function(t){var e=this,n=new l(0,0),r=10*this.radius,o=0;return t.forEach((function(t){var i=l.dist(e.location,t.location);i>0&&i<r&&(n.add(t.location),o++)})),o>0?(n.mult(1/o),this.seek(n)):new l(0,0)},e.prototype.setAngle=function(t,e){var n=t.length;t.x=Math.cos(e)*n,t.y=Math.sin(e)*n},e}(p),d=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isDead=!1,e}return d(e,t),e.prototype.kill=function(){this.isDead=!0},e.prototype.update=function(){t.prototype.update.call(this);var e=.5*this.radius;(this.location.x<e||this.location.x>n-e||this.location.y<e||this.location.y>r-e)&&this.kill()},e}(y),m=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),b=function(e){function n(n,r,o){var i=e.call(this,n,r)||this;return i.groupId=o,i.baseMaxSpeed=4,i.characterType=t.FALLOW_DEER,i}return m(n,e),n.isFallowDeer=function(e){return e.characterType===t.FALLOW_DEER},n.prototype.retrieveDeersFromSameGroup=function(t){var e=this;return t.filter((function(t){return n.isFallowDeer(t)&&(null==t?void 0:t.groupId)===e.groupId&&t!==e}))},n.prototype.getCurrentBehaviourForce=function(n){var r=this,o=this.retrieveDeersFromSameGroup(n),i=n.filter((function(e){return e.characterType===t.WOLF})),a=e.prototype.separate.call(this,i,15*this.radius);if(o.length<=2&&!a.isNull())return a;if(o.length<=2)return this.wander();var s=e.prototype.flock.call(this,o);if(s.isNull()){var u=o.map((function(t){return{object:t,distance:l.dist(r.location,t.location)}})).sort((function(t,e){return t.distance-e.distance}))[0].object.location,c=this.seek(u);return c.mult(2),l.sum(a,c)}return a.mult(3),l.sum(a,s)},n}(v),w=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},g=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),x=function(e){function n(n,r){var o=e.call(this,n,r)||this;return o.baseMaxSpeed=5,o.power=20,o.characterType=t.WOLF,o.decreasePower=o.decreasePower.bind(o),o.powerTimer=window.setInterval(o.decreasePower,1e3),o}return g(n,e),n.prototype.kill=function(){clearInterval(this.powerTimer),e.prototype.kill.call(this)},n.prototype.getCurrentBehaviourForce=function(t){return this.hunt(t)},n.prototype.decreasePower=function(){this.power--,0===this.power&&this.kill()},n.prototype.eatEnemy=function(t){this.power+=n.ENEMIES_POWER_REWARD[t.characterType],t.kill()},n.prototype.hunt=function(t){var e=this,r=t.filter((function(t){return n.ENEMIES.includes(t.characterType)})),o=10*this.radius,i=r.map((function(t){return{enemy:t,dist:l.dist(e.location,t.location)}})).filter((function(t){return t.dist<=t.enemy.radius?(e.eatEnemy(t.enemy),!1):t.dist<o})).sort((function(t,e){return t.dist-e.dist}))[0];return i?this.seek(i.enemy.location):this.wander()},n.ENEMIES=[t.RABBIT,t.FALLOW_DEER,t.HUNTER],n.ENEMIES_POWER_REWARD=((a={})[t.RABBIT]=10,a[t.FALLOW_DEER]=20,a[t.HUNTER]=20,a),n}(v),_=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),E=function(e){function n(n,r){var o=e.call(this,n,r)||this;return o.wanderingSpeed=3,o.separationSpeed=8,o.characterType=t.RABBIT,o.separate=o.separate.bind(o),o}return _(n,e),n.prototype.getCurrentBehaviourForce=function(t){var n=e.prototype.separate.call(this,t);return n.isNull()?(this.baseMaxSpeed=this.wanderingSpeed,this.wander()):(this.baseMaxSpeed=this.separationSpeed,n.mult(1.1),n)},n}(v),O=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),A=function(e){function n(n,r){var o=e.call(this,n.x,n.y)||this;return o.startLocation=n,o.direction=r,o.baseMaxSpeed=20,o.maxShotDistance=200,o.characterType=t.BULLET,o}return O(n,e),n.prototype.getCurrentBehaviourForce=function(t){return this.fly(t)},n.prototype.fly=function(e){var n=this;return l.dist(this.location,this.startLocation)>this.maxShotDistance?(this.kill(),new l(0,0)):(e.forEach((function(e){l.dist(n.location,e.location)<e.radius&&e.characterType!==t.HUNTER&&(e.kill(),n.kill())})),this.direction)},n}(v),F=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),M=function(e){function n(n,r){var o=e.call(this,n,r)||this;return o.baseMaxSpeed=3,o.bulletsCount=10,o.bullets=[],o.radius=13,o.characterType=t.HUNTER,o.handleKeyPress=o.handleKeyPress.bind(o),o.shot=o.shot.bind(o),o.startListeningUserActions(),o}return F(n,e),n.prototype.getCurrentBehaviourForce=function(t){return this.arrive(t)},n.prototype.kill=function(){window.removeEventListener("keypress",this.handleKeyPress),window.removeEventListener("click",this.shot),e.prototype.kill.call(this)},n.prototype.startListeningUserActions=function(){window.addEventListener("keypress",this.handleKeyPress),o.addEventListener("click",this.shot)},n.prototype.handleKeyPress=function(t){" "===t.key&&this.shot()},n.prototype.shot=function(){if(this.bulletsCount&&!this.isDead){var t=new A(this.location,this.velocity.clone());this.bullets.push(t),this.bulletsCount--}},n}(v),B=function(){function e(){}return e.generateDeersGroup=function(t){var n=e.getRandomGroupsCount(t),r=t;return new Array(n).fill(0).map((function(t,o){var i=e.createGroup(o,r,n);return r-=i.length,i})).flat()},e.generateCharacter=function(t){return new e.CHARACTERS_MAP[t](Math.random()*n,Math.random()*r)},e.generateCharactersList=function(t,n){return new Array(t).fill(0).map(e.generateCharacter.bind(null,n))},e.generateWolves=function(n){return e.generateCharactersList(n,t.WOLF)},e.generateRabbits=function(n){return e.generateCharactersList(n,t.RABBIT)},e.generateHunter=function(){return e.generateCharacter(t.HUNTER)},e.getRandomGroupsCount=function(t){var e=Math.floor(t/8)+1,n=Math.floor(t/3);return w(e,n)},e.createGroupMember=function(t,e,n){var r=w(t-10,t+10),o=w(e-10,e+10);return new b(r,o,n)},e.createGroup=function(t,o,i){var a=e.getRandomDeersCountForGroup(i,t,o),s=Math.random()*n,u=Math.random()*r;return new Array(a).fill(0).map((function(){return e.createGroupMember(s,u,t)}))},e.getRandomDeersCountForGroup=function(t,e,n){var r=n-3*(t-e-1),o=Math.min(r,8);return e===t-1?n:w(3,o)},e.CHARACTERS_MAP=((s={})[t.HUNTER]=M,s[t.RABBIT]=E,s[t.WOLF]=x,s[t.FALLOW_DEER]=b,s),e}(),R=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},L=document.getElementById("bulletsNumber"),S=document.getElementById("bulletsAmountText"),T=function(){function t(t){this.field=t,this.rabbits=[],this.wolves=[],this.deers=[],this.hunter=null,this.objects=[],this.mouse=new l(0,0),this.handleMouseMove(),this.startGame(),this.updateFrame()}return t.prototype.startGame=function(t,e,n){void 0===t&&(t=7),void 0===e&&(e=3),void 0===n&&(n=15),S.style.display="block",this.deers=B.generateDeersGroup(n),this.rabbits=B.generateRabbits(t),this.wolves=B.generateWolves(e),this.hunter=B.generateHunter(),this.objects=R(this.rabbits,this.wolves,this.deers)},t.prototype.updateFrame=function(){this.objects=this.objects.filter((function(t){return!t.isDead}));var t=R(this.objects);this.hunter.isDead||t.push(this.hunter),this.updateCharacters(t),this.updateBullets(t),this.hunter.isDead?S.style.display="none":(this.updateHunter(),this.field.drawBulletsAmount(this.hunter.bulletsCount,L)),this.field.drawField(R(t,this.hunter.bullets)),requestAnimationFrame(this.updateFrame.bind(this))},t.prototype.updateBullets=function(t){this.hunter.bullets=this.hunter.bullets.filter((function(t){return!t.isDead})),this.hunter.bullets.forEach((function(e){return e.simulateCurrentBehaviour(t)}))},t.prototype.updateHunter=function(){this.hunter.simulateCurrentBehaviour(this.mouse)},t.prototype.updateCharacters=function(t){this.objects.forEach((function(e){e.simulateCurrentBehaviour(t)}))},t.prototype.handleMouseMove=function(){var t=this;o.addEventListener("mousemove",(function(e){t.mouse.x=e.clientX,t.mouse.y=e.clientY}))},t}(),j=document.getElementById("form"),C=document.getElementById("rabbits"),P=document.getElementById("deers"),D=document.getElementById("wolves"),I=new h;I.createCanvas(),C.value=String(7),D.value=String(3),P.value=String(15);var k=new T(I);j.addEventListener("submit",(function(t){t.preventDefault(),t.target[3].blur(),k.startGame(Number(C.value),Number(D.value))}))}();